/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
var $iframe,$newiframe,$fteIframe,disableKeyZoom,disableWheelZoom;const newIframeTop=150,docUrl=document.location.href;function GetChromeMenuDimensions(e,t){const i=t.version>SETTINGS.READER_VER,o=t.version==SETTINGS.READER_VER,n=t.panel_op,s={width:0,height:0};if("searchWidget"===e)switch(n){case"html_menu":case"status":case"test":i?(s.width=259,s.height=450):(s.width=294,s.height=624);break;case"pdf_menu":o?(s.width=294,s.height=350):i?(s.width=259,s.height=400):(s.width=294,s.height=160);break;case"load-frictionless":s.width=294,s.height=521}else"persistent"===e&&"pdf_menu"===n?(s.width=350,s.height=280):"fte"===e&&(s.width=365,s.height=510);return s}function GetEdgeMenuDimensions(e,t){const i=t.version>SETTINGS.READER_VER,o=t.version==SETTINGS.READER_VER,n=t.panel_op,s={width:0,height:0};if("searchWidget"===e)switch(n){case"html_menu":case"status":case"test":i?(s.width=259,s.height=450):(s.width=294,s.height=624);break;case"pdf_menu":o?(s.width=294,s.height=350):i?(s.width=294,s.height=400):(s.width=294,s.height=180);break;case"load-frictionless":s.width=294,s.height=550}else"persistent"===e&&"pdf_menu"===n?SETTINGS.IS_BETA||!i?(s.width=350,s.height=280):i&&(s.width=200,s.height=50):"fte"===e&&(s.width=302,s.height=510);return s}function GetMenuDimensions(e,t){return t.is_edge?GetEdgeMenuDimensions(e,t):GetChromeMenuDimensions(e,t)}function moveNewIframe(e,t){"dc-cv-fte-pdf-dmb"!==t&&($newiframe=$("#__acrobatNewDialog__")).length>0&&$newiframe.css({top:`${e}px`,transition:"top 0.5s ease 0s"})}function createAndInjectIframe(e){let t=e.base64PDF;delete e.base64PDF;let i="message="+encodeURIComponent(JSON.stringify(e));e.base64PDF=t;const o=GetMenuDimensions("searchWidget",e);if(o.width<=0||o.height<=0)return;let n="block";"hidden"===e.frame_visibility&&(n="none"),($iframe=$("<iframe>")).attr("id","__acrobatDialog__").css({border:"0px","z-index":2147483647,position:"fixed",top:"-5px",right:"80px",width:o.width+"px",height:o.height+"px",display:n,margin:"auto"}).attr("src",chrome.runtime.getURL("browser/js/frame.html")+"?"+i).appendTo("html"),$(document).on("keydown",disableKeyZoom),$(document).on("mousewheel",disableWheelZoom),$newiframe=$("#__acrobatNewDialog__");const{top:s}=$newiframe.offset()||{};if(o.height>s){moveNewIframe(s+(o.height-s),e.fteFeatureFlag)}}function injectFrame(e){"use strict";0===($iframe=$("#__acrobatDialog__")).length?createAndInjectIframe(e):"none"===$iframe.css("display")&&"visible"===e.frame_visibility&&$iframe.css({display:"block"})}function injectPersistFrame(e){if("application/pdf"!==document.contentType||e.url.startsWith("file://"))return;let t=e.base64PDF;delete e.base64PDF;let i="message="+encodeURIComponent(JSON.stringify(e));const o=GetMenuDimensions("persistent",e);o.width<=0||o.height<=0||(e.base64PDF=t,0===($newiframe=$("#__acrobatNewDialog__")).length&&("dc-cv-fte-pdf-dmb"===e.fteFeatureFlag&&$("embed")[0]&&($("embed")[0].style.top="48px",$("embed")[0].style.transition="top 1s ease 0s"),$newiframe=$("<iframe>").attr("id","__acrobatNewDialog__").css({border:"0px",position:"fixed",top:`${newIframeTop}px`,right:"15px",height:o.height+"px",width:o.width+"px",display:"block",margin:"auto",..."dc-cv-fte-pdf-dmb"===e.fteFeatureFlag&&{position:"absolute",top:"0px",right:"0px",height:"48px",width:"100%"}}).attr("src",chrome.runtime.getURL("browser/js/frameUI.html")+"?"+i).appendTo("html"),$(document).on("keydown",disableKeyZoom),$(document).on("mousewheel",disableWheelZoom)))}function errorOpeningPDF(e){e.panel_op="status",e.current_status="pdf_failure",e.main_op="open_in_acrobat",chrome.runtime.sendMessage(e)}function downloadAuthenticatedPDF(e){let t=new XMLHttpRequest;t.open("GET",e.url,!0),t.responseType="blob",t.onerror=function(t){errorOpeningPDF(e)},t.onload=function(i){let o;t.status<400&&(e.url===t.responseURL||"application/pdf"===t.response.type)?(o=new FileReader,o.onloadend=function(t){e.base64PDF=t.target.result,e.content_op="status",e.current_status="pdf_downloaded",e.main_op="open_in_acrobat",chrome.runtime.sendMessage(e)},o.readAsDataURL(t.response)):errorOpeningPDF(e)},t.send()}function handler(e,t,i){"use strict";if(!e.authenticatedPDF||1!=e.authenticatedPDF||"pdf_downloading"!==e.current_status){if("dismiss"===e.content_op)if(delete e.content_op,$iframe=$("#__acrobatDialog__"),1==e.fteUI){if(delete e.fteUI,$fteIframe)return $(document).off("keydown",disableKeyZoom),$(document).off("mousewheel",disableWheelZoom),$fteIframe.remove(),void($fteIframe=null)}else if(1==e.newUI){if(delete e.newUI,$newiframe)return $(document).off("keydown",disableKeyZoom),$(document).off("mousewheel",disableWheelZoom),$newiframe.remove(),"dc-cv-fte-pdf-dmb"===e.fteFeatureFlag&&$("embed")[0]&&($("embed")[0].style.top="0px"),void($newiframe=null)}else if((null!=e.frictionless_workflow||e.forced_cancel)&&(delete e.frictionless_workflow,$iframe))return $(document).off("keydown",disableKeyZoom),$(document).off("mousewheel",disableWheelZoom),$iframe.remove(),void($iframe=null);return e.panel_op&&($fteIframe&&$fteIframe.remove(),"load-frictionless"===e.panel_op&&e.pdf_action?"resize_window"===e.content_op?(delete e.content_op,delete e.window_height):injectFrame(e):1!=e.newUI&&1!=e.persist||(delete e.newUI,injectPersistFrame(e))),!1}downloadAuthenticatedPDF(e)}isSupportedBrowserVersion()&&isGoogleQuery(docUrl)&&chrome.runtime.sendMessage({main_op:"html-startup",url:document.location.href,startup_time:Date.now()}),disableKeyZoom=function(e){"use strict";e.ctrlKey&&-1!==[187,189,107,109].indexOf(e.keyCode)&&e.preventDefault()},disableWheelZoom=function(e){"use strict";e.ctrlKey&&e.preventDefault()},void 0!==chrome.runtime&&chrome.runtime.onMessage.addListener(handler);